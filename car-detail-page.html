<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
  </head>
  <style>
    small {
      font-size: 14px;
      font-weight: 400;
    }

    .actual-price {
      font-size: 14px;
      text-decoration: line-through;
    }

    .date-fields {
      height: 50px;
      border-radius: 8px 0px 0px 8px;
      border-right: 0px;
    }

    .time-fields {
      height: 50px;
      border-radius: 0px 8px 8px 0px;
    }

    .date-fields[readonly] {
      background-color: #ffffff;
    }

    .next-btn {
      height: 50px;
    }

    .days-price,
    .car-price {
      font-size: 16px;
    }

    .car-price,
    .total-price-crp {
      text-align: right;
    }

    .total-crp {
      font-weight: 700;
    }

    /*Date Range Picker*/
    /* Popup background */
    .popup {
      display: none;
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 999;
    }

    /* Popup content */
    .popup-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      padding: 30px;
      width: 500px;
      max-width: 90vw;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      text-align: center;
      overflow: hidden;
    }

    /* Close button */
    .close-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      cursor: pointer;
      font-size: 30px;
      font-weight: bold;
      color: #333;
    }

    .close-btn:hover {
      color: #ff5e57;
    }

    /* Month navigation */
    .month-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      margin-top: 30px;
    }

    #monthYear {
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    /* Modern button design */
    button {
      padding: 10px 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    /* Calendar styles */
    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      max-width: 100%; /* Ensure the calendar is contained within the container */
    }

    .day-of-week,
    .day {
      padding: 10px;
      text-align: center;
      font-size: 14px;
      font-weight: bold;
    }

    .day-of-week {
      background-color: #007bff;
      color: white;
      border-radius: 5px;
      height: 40px; /* Ensures consistent height */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .day {
      background-color: #f0f0f0;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.2s ease;
      height: 40px; /* Ensures consistent height */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .day:hover {
      background-color: #007bff;
      color: white;
    }

    /* Highlight the range when hovering */
    .hovered-in-range {
      background-color: #d4e5ff; /* Light blue for hovered dates */
    }

    /* Highlight the selected range */
    .in-range {
      background-color: #a0c4ff; /* Blue for dates within the selected range */
    }

    /* Highlight the start date */
    .start-date {
      background-color: #4a90e2; /* Darker blue for the start date */
      color: white;
    }

    /* Highlight the end date */
    .end-date {
      background-color: #4a90e2; /* Darker blue for the end date */
      color: white;
    }

    /* Disabled day style */
    .disabled {
      background-color: #e0e0e0;
      color: #999;
      cursor: not-allowed;
    }

    .display-pricing {
      display: none;
    }

    #discountDisplay {
      color: #28a745;
      font-weight: 600;
    }
  </style>
  <body>
    <div class="row align-items-start">
      <div class="col">
        <div class="shadow p-3 mb-5 bg-white rounded">
          <h3>
            $450 <small><span class="actual-price">$550</span>/day</small>
          </h3>
          <div class="row gx-0">
            <div class="col">
              <input
                type="text"
                readonly
                class="form-control start-date-crp date-fields"
                placeholder="Start Date*"
                id="startDateInput"
              />
            </div>
            <div class="col">
              <select class="form-control start-time-crp time-fields">
                <option>ABC</option>
              </select>
            </div>
          </div>
          <br />
          <div class="row gx-0">
            <div class="col">
              <input
                type="text"
                readonly
                class="form-control end-date-crp date-fields"
                placeholder="End Date*"
                id="endDateInput"
              />
            </div>
            <div class="col">
              <select class="form-control start-time-crp time-fields">
                <option>ABC</option>
              </select>
            </div>
          </div>
          <br />
          <div class="d-grid gap-2">
            <input
              type="submit"
              value="Next"
              class="btn btn-primary next-btn"
            />
          </div>
          <br />
          <div class="display-pricing">
            <div class="row gx-0">
              <div class="col days-price" id="pricePerDayDisplay"></div>
              <div class="col car-price" id="totalPricePerDayDisplay"></div>
            </div>
            <div class="discount-pricing-section">
              <div class="row gx-0">
                <div class="col days-price" id="discount-type"></div>
                <div class="col car-price" id="discountDisplay"></div>
              </div>
            </div>
            <div class="row gx-0">
              <div class="col days-price">Taxes & Fees</div>
              <div class="col car-price" id="totalTaxFees"></div>
            </div>
            <hr />
            <div class="row gx-0">
              <div class="col total-crp Total-charges-crp">Total Charges</div>
              <div class="col total-crp total-price-crp" id="totalPrice"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Calendar Popup -->
    <div id="calendarPopup" class="popup">
      <div class="popup-content">
        <span id="closePopupBtn" class="close-btn">&times;</span>
        <div class="month-navigation">
          <button id="prevMonthBtn">&lt;</button>
          <span id="monthYear"></span>
          <button id="nextMonthBtn">&gt;</button>
        </div>
        <div id="calendar"></div>
      </div>
    </div>

    <script>
      // Get elements
      const calendarPopup = document.getElementById("calendarPopup");
      const closePopupBtn = document.getElementById("closePopupBtn");
      const calendarDiv = document.getElementById("calendar");
      const monthYearLabel = document.getElementById("monthYear");
      const prevMonthBtn = document.getElementById("prevMonthBtn");
      const nextMonthBtn = document.getElementById("nextMonthBtn");
      const startDateInput = document.getElementById("startDateInput");
      const endDateInput = document.getElementById("endDateInput");
      const pricePerDayDisplay = document.getElementById("pricePerDayDisplay");
      const totalPriceDisplay = document.getElementById(
        "totalPricePerDayDisplay"
      );
      const taxAndFees = document.getElementById("totalTaxFees");
      const totalPriceShow = document.getElementById("totalPrice");
      const discountSec = document.querySelector(".discount-pricing-section");
      const discountType = document.getElementById("discount-type");
      const discountDisplay = document.getElementById("discountDisplay"); // New element to display discount

      // Variables to store the current date and selected range
      let currentDate = new Date();
      let startDate = null;
      let endDate = null;

      // Pricing Variables
      const pricePerDay = 450; // Base price per day
      const taxRate = 9; // Fixed taxes and fees percentage
      const weeklyDiscount = 0.15; // 15% weekly discount for 7+ days
      const monthlyDiscount = 0.3; // 30% monthly discount for 30+ days

      // Open the calendar popup when clicking on the input fields
      startDateInput.addEventListener("click", function () {
        resetSelection();
        calendarPopup.style.display = "block";
        renderCalendar(currentDate);
      });

      endDateInput.addEventListener("click", function () {
        resetSelection();
        calendarPopup.style.display = "block";
        renderCalendar(currentDate);
      });

      // Reset date selection and price display
      function resetSelection() {
        startDate = null;
        endDate = null;
        startDateInput.value = "";
        endDateInput.value = "";
        pricePerDayDisplay.innerHTML = "";
        taxAndFees.innerHTML = "";
        totalPriceDisplay.innerHTML = "";
        totalPriceShow.innerHTML = "";
      }

      // Close the popup
      closePopupBtn.addEventListener("click", function () {
        calendarPopup.style.display = "none";
      });

      // Handle Previous and Next Month buttons
      prevMonthBtn.addEventListener("click", function () {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
      });

      nextMonthBtn.addEventListener("click", function () {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
      });

      // Function to format date as YYYY-MM-DD
      function formatDate(date) {
        return (
          date.getFullYear() +
          "-" +
          (date.getMonth() + 1).toString().padStart(2, "0") +
          "-" +
          date.getDate().toString().padStart(2, "0")
        );
      }

      // Array to hold specific disabled dates
      let disabledDates = [];

      // Function to disable specific dates
      function disableSpecificDates(datesArray) {
        disabledDates = datesArray.map((date) =>
          new Date(date).setHours(0, 0, 0, 0)
        );
      }

      // Function to check if any dates between the start and end dates are disabled
      function isRangeValid(startDate, endDate) {
        const start = new Date(startDate).getTime();
        const end = new Date(endDate).getTime();

        for (let i = start; i <= end; i += 86400000) {
          if (disabledDates.includes(i)) {
            return false;
          }
        }
        return true;
      }

      // Render the calendar with range selection and mouse effects
      function renderCalendar(date) {
        const monthNames = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        const daysOfWeek = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

        const today = new Date();
        today.setHours(0, 0, 0, 0); // Normalize time

        calendarDiv.innerHTML = "";
        monthYearLabel.innerText = `${
          monthNames[date.getMonth()]
        } ${date.getFullYear()}`;

        daysOfWeek.forEach((day) => {
          const dayDiv = document.createElement("div");
          dayDiv.className = "day-of-week";
          dayDiv.innerText = day;
          calendarDiv.appendChild(dayDiv);
        });

        const firstDayOfMonth = new Date(
          date.getFullYear(),
          date.getMonth(),
          1
        );
        const lastDayOfMonth = new Date(
          date.getFullYear(),
          date.getMonth() + 1,
          0
        );

        // Add empty cells for days before the first day of the month
        for (let i = 0; i < firstDayOfMonth.getDay(); i++) {
          const emptyDiv = document.createElement("div");
          calendarDiv.appendChild(emptyDiv);
        }

        // Add days of the month
        for (let day = 1; day <= lastDayOfMonth.getDate(); day++) {
          const dayDiv = document.createElement("div");
          dayDiv.className = "day";
          dayDiv.innerText = day;

          const dateObj = new Date(date.getFullYear(), date.getMonth(), day);
          dateObj.setHours(0, 0, 0, 0);

          if (dateObj < today || disabledDates.includes(dateObj.getTime())) {
            dayDiv.classList.add("disabled");
            dayDiv.style.pointerEvents = "none";
            dayDiv.style.opacity = "0.5";
          }

          if (
            startDate &&
            endDate &&
            dateObj >= startDate &&
            dateObj <= endDate
          ) {
            dayDiv.classList.add("in-range");
          } else if (startDate && dateObj.getTime() === startDate.getTime()) {
            dayDiv.classList.add("start-date");
          } else if (endDate && dateObj.getTime() === endDate.getTime()) {
            dayDiv.classList.add("end-date");
          }

          if (dateObj >= today && !disabledDates.includes(dateObj.getTime())) {
            dayDiv.addEventListener("mouseover", function () {
              if (startDate && !endDate) {
                highlightRange(startDate, dateObj);
              }
            });

            dayDiv.addEventListener("click", function () {
              if (!startDate || (startDate && endDate)) {
                startDate = dateObj;
                endDate = null;
                startDateInput.value = formatDate(startDate);
                resetPriceDisplay();
              } else if (startDate && !endDate) {
                if (dateObj >= startDate && isRangeValid(startDate, dateObj)) {
                  endDate = dateObj;
                  endDateInput.value = formatDate(endDate);
                  calculateAndDisplayPrice(); // Calculate price when both dates are selected
                  calendarPopup.style.display = "none";
                } else {
                  alert("End date cannot be selected due to disabled dates.");
                }
              }
              renderCalendar(currentDate);
            });
          }

          calendarDiv.appendChild(dayDiv);
        }
      }

      // Highlight date range while hovering
      function highlightRange(start, hoverDate) {
        const allDays = document.querySelectorAll(".day");
        allDays.forEach((dayDiv) => {
          const day = parseInt(dayDiv.innerText);
          const dateObj = new Date(
            currentDate.getFullYear(),
            currentDate.getMonth(),
            day
          );
          dateObj.setHours(0, 0, 0, 0);

          if (dateObj >= start && dateObj <= hoverDate) {
            dayDiv.classList.add("hovered-in-range");
          } else {
            dayDiv.classList.remove("hovered-in-range");
          }
        });
      }

      // Function to calculate and display the price with discounts
      function calculateAndDisplayPrice() {
        if (startDate && endDate) {
          const timeDiff = Math.abs(endDate - startDate);
          const numOfDays = Math.ceil(timeDiff / (1000 * 60 * 60 * 24)) + 1; // Number of days

          // Calculate base price without discount
          let totalPriceWithoutDiscount = pricePerDay * numOfDays;
          let discountValue = 0;
          if (numOfDays >= 30) {
            discountValue = Math.round(
              totalPriceWithoutDiscount * monthlyDiscount
            ); // Monthly discount
            discountType.innerHTML = "Monthly Discount";
          } else if (numOfDays >= 7) {
            discountValue = Math.round(
              totalPriceWithoutDiscount * weeklyDiscount
            ); // Weekly discount
            discountType.innerHTML = "Weekly Discount";
          } else {
            discountSec.style.display = "none";
          }

          // Calculate final price after applying discount
          const totalPrice = totalPriceWithoutDiscount - discountValue;

          // Calculate taxes
          const taxes = Math.round((totalPrice * taxRate) / 100);
          const totalCharges = Math.round(totalPrice + taxes);

          document.querySelector(".display-pricing").style.display = "block";

          // Display pricing breakdown
          pricePerDayDisplay.innerHTML = `$${pricePerDay} x ${numOfDays}d`;
          discountDisplay.innerHTML = `-$${discountValue}`;
          totalPriceDisplay.innerHTML = `$${totalPriceWithoutDiscount}`;
          taxAndFees.innerHTML = `$${taxes}`;
          totalPriceShow.innerHTML = `$${totalCharges}`;
        }
      }

      // Reset price display when dates are changed
      function resetPriceDisplay() {
        pricePerDayDisplay.innerHTML = "";
        totalPriceDisplay.innerHTML = "";
        discountDisplay.innerHTML = ""; // Reset discount display
        taxAndFees.innerHTML = "";
        totalPriceShow.innerHTML = "";
      }

      // Initial calendar render
      renderCalendar(currentDate);
    </script>
  </body>
</html>
