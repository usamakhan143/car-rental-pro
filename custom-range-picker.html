<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Range Picker Calendar</title>
  </head>
  <style>
    /* General Reset */
    /* * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Arial", sans-serif;
    } */

    /* Disabled day style */
    .disabled {
      background-color: #e0e0e0;
      color: #999;
      cursor: not-allowed;
    }

    /* Date Input Fields */
    .date-fields {
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .date-fields label {
      font-size: 16px;
      color: #333;
    }

    .date-fields input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 150px;
      font-size: 14px;
      background-color: #f9f9f9;
    }

    /* Popup background */
    .popup {
      display: none;
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 999;
    }

    /* Popup content */
    .popup-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      padding: 30px;
      width: 500px;
      max-width: 90vw;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      text-align: center;
      overflow: hidden;
    }

    /* Close button */
    .close-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      cursor: pointer;
      font-size: 30px;
      font-weight: bold;
      color: #333;
    }

    .close-btn:hover {
      color: #ff5e57;
    }

    /* Month navigation */
    .month-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      margin-top: 15px;
    }

    #monthYear {
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    /* Modern button design */
    button {
      padding: 10px 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    /* Calendar styles */
    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      max-width: 100%; /* Ensure the calendar is contained within the container */
    }

    .day-of-week,
    .day {
      padding: 10px;
      text-align: center;
      font-size: 14px;
      font-weight: bold;
    }

    .day-of-week {
      background-color: #007bff;
      color: white;
      border-radius: 5px;
      height: 40px; /* Ensures consistent height */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .day {
      background-color: #f0f0f0;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.2s ease;
      height: 40px; /* Ensures consistent height */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .day:hover {
      background-color: #007bff;
      color: white;
    }

    /* Highlight the range when hovering */
    .hovered-in-range {
      background-color: #d4e5ff; /* Light blue for hovered dates */
    }

    /* Highlight the selected range */
    .in-range {
      background-color: #a0c4ff; /* Blue for dates within the selected range */
    }

    /* Highlight the start date */
    .start-date {
      background-color: #4a90e2; /* Darker blue for the start date */
      color: white;
    }

    /* Highlight the end date */
    .end-date {
      background-color: #4a90e2; /* Darker blue for the end date */
      color: white;
    }
  </style>
  <body>
    <!-- Date Fields -->
    <div class="date-fields">
      <label for="startDateInput">Start Date:</label>
      <input type="text" id="startDateInput" readonly />

      <label for="endDateInput">End Date:</label>
      <input type="text" id="endDateInput" readonly />
      <div id="pricePerDayDisplay"></div>
      <div id="totalTaxFees"></div>
      <div id="totalPricePerDayDisplay"></div>
      <div id="totalPrice"></div>
      <!-- New element to display the price -->
    </div>

    <!-- Calendar Popup -->
    <div id="calendarPopup" class="popup">
      <div class="popup-content">
        <span id="closePopupBtn" class="close-btn">&times;</span>
        <div class="month-navigation">
          <button id="prevMonthBtn">&lt;</button>
          <span id="monthYear"></span>
          <button id="nextMonthBtn">&gt;</button>
        </div>
        <div id="calendar"></div>
      </div>
    </div>

    <script>
      // Get elements
      const calendarPopup = document.getElementById("calendarPopup");
      const closePopupBtn = document.getElementById("closePopupBtn");
      const calendarDiv = document.getElementById("calendar");
      const monthYearLabel = document.getElementById("monthYear");
      const prevMonthBtn = document.getElementById("prevMonthBtn");
      const nextMonthBtn = document.getElementById("nextMonthBtn");
      const startDateInput = document.getElementById("startDateInput");
      const endDateInput = document.getElementById("endDateInput");
      const pricePerDayDisplay = document.getElementById("pricePerDayDisplay"); // New element for displaying price
      const totalPriceDisplay = document.getElementById(
        "totalPricePerDayDisplay"
      );
      const taxAndFees = document.getElementById("totalTaxFees");
      const totalPriceShow = document.getElementById("totalPrice");

      // Variables to store the current date and selected range
      let currentDate = new Date();
      let startDate = null;
      let endDate = null;

      // Price per day
      const pricePerDay = 450; // Set your price here
      const taxesAndFees = 122; // Fixed taxes and fees

      // Open the calendar popup when clicking on the input fields
      startDateInput.addEventListener("click", function () {
        startDate = null;
        endDate = null;
        startDateInput.value = ""; // Clear the start date input field
        endDateInput.value = ""; // Clear the end date input field
        pricePerDayDisplay.innerHTML = "";
        taxAndFees.innerHTML = "";
        totalPriceDisplay.innerHTML = "";
        totalPriceShow.innerHTML = "";
        calendarPopup.style.display = "block";
        renderCalendar(currentDate); // Render the calendar with the current date
      });

      endDateInput.addEventListener("click", function () {
        startDate = null;
        endDate = null;
        startDateInput.value = ""; // Clear the start date input field
        endDateInput.value = ""; // Clear the end date input field
        pricePerDayDisplay.innerHTML = "";
        taxAndFees.innerHTML = "";
        totalPriceDisplay.innerHTML = "";
        totalPriceShow.innerHTML = "";
        calendarPopup.style.display = "block";
        renderCalendar(currentDate); // Render the calendar with the current date
      });

      // Close the popup
      closePopupBtn.addEventListener("click", function () {
        calendarPopup.style.display = "none";
      });

      // Handle Previous Month button click
      prevMonthBtn.addEventListener("click", function () {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
      });

      // Handle Next Month button click
      nextMonthBtn.addEventListener("click", function () {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
      });

      // Function to format date as YYYY-MM-DD
      function formatDate(date) {
        return (
          date.getFullYear() +
          "-" +
          (date.getMonth() + 1).toString().padStart(2, "0") +
          "-" +
          date.getDate().toString().padStart(2, "0")
        );
      }

      // Array to hold specific disabled dates
      let disabledDates = [];

      // Function to set the dates to be disabled
      function disableSpecificDates(datesArray) {
        disabledDates = datesArray.map((date) =>
          new Date(date).setHours(0, 0, 0, 0)
        );
      }

      // Function to check if any dates between the start and end dates are disabled
      function isRangeValid(startDate, endDate) {
        const start = new Date(startDate).getTime();
        const end = new Date(endDate).getTime();

        for (let i = start; i <= end; i += 86400000) {
          if (disabledDates.includes(i)) {
            return false;
          }
        }
        return true;
      }

      // Function to render the calendar with the range selection mouse effect
      function renderCalendar(date) {
        const monthNames = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        const daysOfWeek = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

        const today = new Date();
        today.setHours(0, 0, 0, 0); // Remove time for accurate comparison

        calendarDiv.innerHTML = ""; // Clear previous calendar

        monthYearLabel.innerText = `${
          monthNames[date.getMonth()]
        } ${date.getFullYear()}`; // Update the month and year label

        // Add days of the week
        daysOfWeek.forEach((day) => {
          const dayDiv = document.createElement("div");
          dayDiv.className = "day-of-week";
          dayDiv.innerText = day;
          calendarDiv.appendChild(dayDiv);
        });

        const firstDayOfMonth = new Date(
          date.getFullYear(),
          date.getMonth(),
          1
        );
        const lastDayOfMonth = new Date(
          date.getFullYear(),
          date.getMonth() + 1,
          0
        );

        // Add empty cells for days before the first day of the month
        for (let i = 0; i < firstDayOfMonth.getDay(); i++) {
          const emptyDiv = document.createElement("div");
          calendarDiv.appendChild(emptyDiv);
        }

        // Add days of the month
        for (let day = 1; day <= lastDayOfMonth.getDate(); day++) {
          const dayDiv = document.createElement("div");
          dayDiv.className = "day";
          dayDiv.innerText = day;

          const dateObj = new Date(date.getFullYear(), date.getMonth(), day);
          dateObj.setHours(0, 0, 0, 0); // Normalize the date

          // Disable past dates and specific disabled dates
          if (dateObj < today || disabledDates.includes(dateObj.getTime())) {
            dayDiv.classList.add("disabled");
            dayDiv.style.pointerEvents = "none"; // Make the date unclickable
            dayDiv.style.opacity = "0.5"; // Visually indicate disabled date
          }

          // Apply range highlighting
          if (
            startDate &&
            endDate &&
            dateObj >= startDate &&
            dateObj <= endDate
          ) {
            dayDiv.classList.add("in-range");
          } else if (startDate && dateObj.getTime() === startDate.getTime()) {
            dayDiv.classList.add("start-date");
          } else if (endDate && dateObj.getTime() === endDate.getTime()) {
            dayDiv.classList.add("end-date");
          }

          // Only add event listener if the date is not disabled
          if (dateObj >= today && !disabledDates.includes(dateObj.getTime())) {
            // Mouse hover effect for date range visualization
            dayDiv.addEventListener("mouseover", function () {
              if (startDate && !endDate) {
                highlightRange(startDate, dateObj);
              }
            });

            dayDiv.addEventListener("click", function () {
              if (!startDate || (startDate && endDate)) {
                startDate = dateObj;
                endDate = null;
                startDateInput.value = formatDate(startDate);
                endDateInput.value = "";
                pricePerDayDisplay.innerHTML = "";
                taxAndFees.innerHTML = "";
                totalPriceDisplay.innerHTML = "";
                totalPriceShow.innerHTML = "";
              } else if (startDate && !endDate) {
                if (dateObj >= startDate) {
                  if (isRangeValid(startDate, dateObj)) {
                    endDate = dateObj;
                    endDateInput.value = formatDate(endDate);
                    calculateAndDisplayPrice(); // Calculate price after end date is selected
                    calendarPopup.style.display = "none";
                  } else {
                    alert(
                      "End date cannot be selected due to disabled dates within the range."
                    );
                  }
                }
              }

              renderCalendar(currentDate); // Rerender the calendar
            });
          }

          calendarDiv.appendChild(dayDiv);
        }
      }

      // Function to highlight the date range while hovering
      function highlightRange(start, hoverDate) {
        const allDays = document.querySelectorAll(".day");
        allDays.forEach((dayDiv) => {
          const day = parseInt(dayDiv.innerText);
          const dateObj = new Date(
            currentDate.getFullYear(),
            currentDate.getMonth(),
            day
          );
          dateObj.setHours(0, 0, 0, 0);

          if (dateObj >= start && dateObj <= hoverDate) {
            dayDiv.classList.add("hovered-in-range");
          } else {
            dayDiv.classList.remove("hovered-in-range");
          }
        });
      }

      // Function to calculate and display the price
      function calculateAndDisplayPrice() {
        if (startDate && endDate) {
          const timeDiff = Math.abs(endDate - startDate);
          const numOfDays = Math.ceil(timeDiff / (1000 * 60 * 60 * 24)) + 1; // Number of days including start and end

          const totalPrice = pricePerDay * numOfDays;
          const totalCharges = totalPrice + taxesAndFees;

          // Display the price breakdown
          pricePerDayDisplay.innerHTML = `
            $${pricePerDay} x ${numOfDays}d: $${totalPrice.toLocaleString()}`;
          taxAndFees.innerHTML = `$${taxesAndFees}`;
          totalPriceDisplay.innerHTML = `$${totalPrice.toLocaleString()}`;
          totalPriceShow.innerHTML = `Charges: $${totalCharges.toLocaleString()}`;
        }
      }

      // Call this function to disable specific dates
      disableSpecificDates(["2024-09-19", "2024-09-20", "2024-09-21"]);
    </script>
  </body>
</html>
